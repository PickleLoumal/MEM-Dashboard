# CSI300 Backend Service Dockerfile
# 基于最新的基础镜像(包含所有更新的代码和migrations)
FROM 952189540759.dkr.ecr.ap-east-1.amazonaws.com/mem-dashboard:csilatest

# 工作目录已在基础镜像中设置为/app
WORKDIR /app/src/django_api

# 暴露Django端口
EXPOSE 8000

# 健康检查
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:8000/health/ || exit 1

# 启动Django服务
CMD ["python3", "manage.py", "runserver", "0.0.0.0:8000"]
