import{R as E,j as t,a as F,r as n,G as I}from"./main-C6QWjLiy.js";const R="http://localhost:8001".replace(/\/$/,"");function O(e){const i=new URLSearchParams;e&&Object.entries(e).forEach(([p,c])=>{c&&i.append(p,c)});const r=i.toString();return`${R}/api/csi300/api/companies/filter_options/${r?`?${r}`:""}`}async function j(e){const i=O(e),r=await fetch(i,{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);return r.json()}function $(e){const[i,r]=n.useState(null),[p,c]=n.useState(!1),[h,l]=n.useState(null);return n.useEffect(()=>{let d=!1;return c(!0),j(e?{im_sector:e}:void 0).then(u=>{d||(r(u),l(null))}).catch(u=>{d||l(u instanceof Error?u.message:"Failed to load filter options")}).finally(()=>{d||c(!1)}),()=>{d=!0}},[e]),{data:i,loading:p,error:h}}function L(e){return e?e.total_count??e.company_count??e.total_companies??null:null}function k(e){return e?e.im_sectors?.length?e.im_sectors:e.im_codes?.length?e.im_codes:e.industries?.length?e.industries:[]:[]}function x(e){return e?e.industries?.length?e.industries:e.im_sectors?.length?e.im_sectors:e.im_codes?.length?e.im_codes:[]:[]}function M(){const[e,i]=n.useState({im_sector:"",industry:"",company_search:"",industry_search:""}),[r,p]=n.useState([]),[c,h]=n.useState(!1),{data:l,loading:d,error:u}=$(e.im_sector),f=n.useMemo(()=>L(l),[l]),v=n.useMemo(()=>k(l),[l]);n.useEffect(()=>{document.title="Chinese Stock Dashboard - Company Filter"},[]),n.useEffect(()=>{p(x(l))},[l]);const m=s=>o=>i(a=>({...a,[s]:o.target.value})),y=()=>"/browser.html",N=s=>{s.preventDefault();const o=new URLSearchParams;Object.keys(e).forEach(g=>{const b=e[g].trim();b&&o.append(g,b)});const a=y(),C=o.toString()?`${a}?${o.toString()}`:a;window.location.href=C},S=()=>{window.location.href=y()},w=async s=>{const o=s.target.value;i(a=>({...a,im_sector:o,industry:""})),h(!0);try{const a=await j(o?{im_sector:o}:void 0);p(x(a))}catch(a){console.error("Failed to load industry options",a)}finally{h(!1)}};return t.jsxs(t.Fragment,{children:[t.jsx(I,{}),t.jsxs("main",{className:"page-shell app-shell",children:[t.jsxs("div",{className:"page-header",children:[t.jsx("h1",{className:"page-title",children:"Chinese Stock Dashboard"}),t.jsx("p",{className:"page-subtitle",children:"Filter and browse Chinese stock companies"})]}),t.jsx("div",{className:"filter-card-wrapper",children:t.jsxs("div",{className:"filter-container app-card",children:[t.jsx("p",{className:"total-count",id:"totalCount",children:d?"Loading total count...":f?`Total ${f} companies in database`:"Chinese Stock Dashboard filters ready"}),u?t.jsx("div",{className:"error app-notice",children:u}):null,t.jsxs("form",{className:"filter-form",onSubmit:N,children:[t.jsxs("div",{className:"filter-grid app-form-grid app-form-grid--two",children:[t.jsxs("div",{className:"filter-group app-form-field",children:[t.jsx("label",{className:"filter-label app-label",children:"Industry Matrix Sector"}),t.jsxs("select",{name:"im_sector",value:e.im_sector,onChange:w,className:"filter-select app-select",children:[t.jsx("option",{value:"",children:"All Industry Matrix Sectors"}),v.map(s=>t.jsx("option",{value:s,children:s},s))]})]}),t.jsxs("div",{className:"filter-group app-form-field",children:[t.jsx("label",{className:"filter-label app-label",children:"Industry within selected sector"}),t.jsxs("select",{name:"industry",value:e.industry,onChange:m("industry"),className:"filter-select app-select",disabled:c,children:[t.jsx("option",{value:"",children:c?"Loading...":"All Industries"}),r.map(s=>t.jsx("option",{value:s,children:s},s))]})]}),t.jsxs("div",{className:"filter-group app-form-field",children:[t.jsx("label",{className:"filter-label app-label",children:"Search Companies"}),t.jsx("input",{type:"text",name:"company_search",value:e.company_search,onChange:m("company_search"),className:"filter-input app-input",placeholder:"Search by company name or ticker..."})]}),t.jsxs("div",{className:"filter-group app-form-field",children:[t.jsx("label",{className:"filter-label app-label",children:"Search by Industry"}),t.jsx("input",{type:"text",name:"industry_search",value:e.industry_search,onChange:m("industry_search"),className:"filter-input app-input",placeholder:"Search by industry name..."})]})]}),t.jsxs("div",{className:"filter-actions app-actions app-actions--center",children:[t.jsx("button",{type:"button",onClick:S,className:"btn btn-secondary app-button app-button--secondary",children:"Clear Filters"}),t.jsx("button",{type:"submit",className:"btn btn-primary app-button app-button--primary",children:"Apply Filters"})]})]})]})})]})]})}const _=document.getElementById("root");if(!_)throw new Error("Root element not found");E.createRoot(_).render(t.jsx(F.StrictMode,{children:t.jsx(M,{})}));
